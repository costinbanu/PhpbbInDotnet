@page
@model PhpbbInDotnet.Forum.Pages.RegisterModel
@{
    ViewData["Title"] = "Register";
    Layout = "~/Pages/_Layout.cshtml";
}

@inject Microsoft.Extensions.Configuration.IConfiguration _config;

<h3>Înregistrare</h3>

<script src="https://www.google.com/recaptcha/api.js?render=@(_config["Recaptcha:SiteKey"])"></script>
<script>
    grecaptcha.ready(function () {
        grecaptcha.execute('@(_config["Recaptcha:SiteKey"])', { action: 'validate_captcha' })
            .then(function (token) {
                $('#RecaptchaResponse').val(token);
            });
    });
</script>




<form asp-controller="Home" method="post">

    <div asp-validation-summary="ModelOnly" class="text-danger"></div>

    <input type="text" name="Email" asp-for="Email" placeholder="Email" class="form" autocomplete="new-password" />
    <br />
    <span asp-validation-for="Email" class="validation"></span>
    <p></p>
    <input type="text" name="UserName" asp-for="UserName" placeholder="Nume utilizator" class="form" autocomplete="new-password" />
    <br />
    <span asp-validation-for="UserName" class="validation"></span>
    <p></p>
    <input type="password" name="Password" asp-for="Password" placeholder="Parola" class="form" autocomplete="new-password" />
    <br />
    <span asp-validation-for="Password" class="validation"></span>
    <p></p>
    <input type="password" name="SecondPassword" asp-for="SecondPassword" placeholder="Repetă parola" class="form" autocomplete="new-password" />
    <br />
    <span asp-validation-for="SecondPassword" class="validation"></span>
    <p></p>
    <input type="checkbox" asp-for="Agree" style="width:auto" /> Sunt de acord cu <a asp-page="/TermsAndConditions" target="_blank">termenele și condițiile de utilizare</a>
    <br />
    <span asp-validation-for="Agree" class="validation"></span>
    <p></p>
    <input type="submit" value="Trimite" style="width:auto" />
    <input type="hidden" asp-for="RecaptchaResponse" id="RecaptchaResponse" />
    <br />
    <span asp-validation-for="RecaptchaResponse" class="validation"></span>
    @Html.AntiForgeryToken()
</form>



<script>
    var defaultRangeValidator = $.validator.methods.range;
    $.validator.methods.range = function (value, element, param) {
        if (element.type === 'checkbox') {
            return element.checked;
        } else {
            return defaultRangeValidator.call(this, value, element, param);
        }
    }

    window.onload = function () {
        var $recaptcha = document.querySelector('#g-recaptcha-response');
        if ($recaptcha) {
            $recaptcha.setAttribute("required", "required");
        };
    };

    function recaptchaCallback() {
        var error = document.getElementById("reCaptchaErrorMessage");
        if (error.style.visibility == "visible") {
            error.style.visibility = "hidden";
        }
    }

    function validateCaptcha() {
        var response = grecaptcha.getResponse();
        if (response.length === 0) {
            document.getElementById("reCaptchaErrorMessage").style.visibility = "visible";
            return false;
        }
        return true;
    }
</script>
