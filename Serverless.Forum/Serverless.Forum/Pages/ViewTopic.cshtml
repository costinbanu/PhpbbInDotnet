@page
@using Serverless.Forum.Utilities;
@model Serverless.Forum.Pages.ViewTopicModel
@{
    ViewData["Title"] = $"{Model.ForumTitle} - {Model.TopicTitle}";
    Layout = "~/Pages/_Layout.cshtml";
}

<script type="text/javascript" src="~/js/mediaResize.js"></script>

@if (Model.ForumId != null)
{
    <h3>Forum părinte: <a asp-page="/ViewForum" asp-route-ForumId="@Model.ForumId">@Model.ForumTitle</a></h3>
}
<h2>Subiect: @Model.TopicTitle</h2>
<p>&nbsp;</p>
<p style="margin:20px;">
    @await Html.PartialAsync("_PaginationPartial", Model.Pagination, ViewData)
</p>
@foreach (var post in Model.Posts)
{
    <div class="ForumListRow">
        <span class="ForumListLeft" id="@post.Id">
            <span class="PostTitle">
                <a asp-page="/ViewTopic" asp-page-handler="ByPostId" asp-route-PostId="@post.Id">@Html.Raw(post.PostTitle)</a>
            </span>
            <p>&nbsp;</p>
            @Html.Raw(post.PostText)
            @foreach (var attachment in from a in post.Attachments
                                       where !a.IsDisplayedInline
                                       select a)
            {
                <p>------------------</p>
                @await Html.PartialAsync("_AttachmentPartial", attachment, ViewData)
            }
            <br/>
            <a asp-page="/Posting" asp-page-handler="QuoteForumPost" asp-route-postId="@post.Id">Răspunde cu citat</a>
        </span>
        <span class="ForumListRight">
            @if (post.AuthorId == null)
            {
                <span>Autor: @Html.Raw(post.AuthorName)</span>
                <br />
                <span>Scris la: @post.PostCreationTime?.ToString(User?.ToLoggedUser()?.UserDateFormat ?? "dddd, dd.MM.yyyy, HH:mm")</span>
            }
            else
            {
                <span>Autor: <a asp-page="/User" asp-route-UserId="@post.AuthorId">@post.AuthorName</a></span>
                <br />
                <span>Scris la: @post.PostCreationTime?.ToString(User?.ToLoggedUser()?.UserDateFormat ?? "dddd, dd.MM.yyyy, HH:mm")</span>
            }
        </span>
    </div>
}
<p style="margin:20px;">
    @await Html.PartialAsync("_PaginationPartial", Model.Pagination, ViewData)
</p>
<br/>
<a asp-page="/Posting" asp-page-handler="ForumPost" asp-route-topicTitle="@Model.TopicTitle">Scrie un răspuns</a>
